<ion-menu side="start" contentId="main" >
  <ion-header>
    <ion-toolbar translucent>
      <ion-title>Menu</ion-title>
    </ion-toolbar>
  </ion-header>
  <ion-content>
    <ion-list>
      <ion-item (click)="IrDatosBasicos()">
        <ion-icon name="person" slot="start"></ion-icon>
        <ion-label>Datos Basicos</ion-label>
      </ion-item>
      <ion-item (click)="Logout()">
        <ion-icon name="exit" slot="start"></ion-icon>
        <ion-label>Salir</ion-label>
      </ion-item>
    </ion-list>
  </ion-content>
</ion-menu>
<div class="ion-page" id="main">
  
  <ion-header translucent>
    <ion-toolbar>
      <ion-buttons slot="start">
        <ion-menu-button ></ion-menu-button>
      </ion-buttons>
      <ion-title>Profile settings</ion-title>
      <fa-icon 
        slot="end" *ngIf="!loading"
        [icon]="[ordenar ? 'far' : 'fas',  'list-alt']"
        class="icon-bar color-medium"
        (click)="Ordenar()"></fa-icon>
       
 
    </ion-toolbar>
  </ion-header>
  <div *ngIf="loading" class="spinner">
    <spinner></spinner>
  </div>

  <ion-content class="ion-padding" *ngIf="!loading" [scrollEvents]="true" (ionScroll)="Scroll($event)"> 
      
    <div class="contenedorAvatar" >
      <ion-avatar class="avatar-profile"> 
        <ion-img [src]="user ? user.avatarUrl : avatar"></ion-img>
      </ion-avatar>
    </div>

    <div class="contenedor" >
      <ion-title class="title-name">
        {{user ? user.firstName + ' ' + user.lastName : 'John Doe'}}
      </ion-title>
    </div>
    
    <form [formGroup]="grupoForm"  (ngSubmit)="onSubmit()">
    
        
    <ion-list >
      <ion-item>
        <fa-icon 
        [icon]="['fas', 'book-open'] "
        class="icono"
        slot="start"></fa-icon>
        <ion-label position="floating">Biografia</ion-label>
        <ion-textarea maxlength="250"
        formControlName="biografia"
        (ionInput)="ChangeData()"
        ></ion-textarea>
      </ion-item>
      <mat-accordion multi="true" cdkDropListGroup>
        <mat-expansion-panel #pp 
        cdkDropList
          [cdkDropListData]="publicoForm"
          (cdkDropListDropped)="MoverItem($event)"
          (cdkDropListEntered)="AbrirPanel(pp)"
          (cdkDropListExited)="CerrarPanel(pp)"
          formArrayName="0"
          >
          <mat-expansion-panel-header>
            <mat-panel-title>
              Publico
            </mat-panel-title>
          </mat-expansion-panel-header>
          <div
            
            class="acordion width-100"
            *ngFor="let itemPublico of publicoForm.controls; let i = index"
            [formGroupName]="i"
            cdkDrag 
            [cdkDragDisabled]="ordenar"
            [ngClass]="{'ordenar': !ordenar}"
            (cdkDragStarted)="Drag()"
            (cdkDragEnded)="Drop()">
              <app-item-perfil  
                [form]="itemPublico"
                formControlName="item"
                [ordenando]="ordenar" 
                (delete)="EliminarElemento(publicoForm, i)"
                (change)="ChangeData()"
                >
              </app-item-perfil>
          </div>
        </mat-expansion-panel>
        <mat-expansion-panel  #pg  
        cdkDropList
          [cdkDropListData]="generalForm"
          (cdkDropListDropped)="MoverItem($event)"
          (cdkDropListEntered)="AbrirPanel(pg)"
          (cdkDropListExited)="CerrarPanel(pg)"
          formArrayName="1"
          >
          <mat-expansion-panel-header>
            <mat-panel-title>
              General
            </mat-panel-title>
          </mat-expansion-panel-header>
            <div 
            class="acordion width-100"
            *ngFor="let itemGeneral of generalForm.controls; let i = index"
            [formGroupName]="i"
            cdkDrag 
            [cdkDragDisabled]="ordenar"
            [ngClass]="{'ordenar': !ordenar}"
            (cdkDragStarted)="Drag()"
            (cdkDragEnded)="Drop()"
            >
              <app-item-perfil  
              [form]="itemGeneral"
              formControlName="item"
              [ordenando]="ordenar" 
              (delete)="EliminarElemento(generalForm, i)"
              (change)="ChangeData()"
              >
              </app-item-perfil>
            </div>
        </mat-expansion-panel>
        
        <mat-expansion-panel  #pper  
          cdkDropList
          [cdkDropListData]="personalForm"
          (cdkDropListEntered)="AbrirPanel(pper)"
          (cdkDropListDropped)="MoverItem($event)"
          (cdkDropListExited)="CerrarPanel(pper)"
          formArrayName="2"
        >
          <mat-expansion-panel-header>
            <mat-panel-title>
              Personal
            </mat-panel-title>
          </mat-expansion-panel-header>
          <div 
          class="acordion width-100"
          *ngFor="let itemPersonal of personalForm.controls; let i = index"
          [formGroupName]="i"
          cdkDrag 
          [cdkDragDisabled]="ordenar"
          [ngClass]="{'ordenar': !ordenar}"
          (cdkDragStarted)="Drag()"
          (cdkDragEnded)="Drop()"
          >
            <app-item-perfil 
            [form]="itemPersonal"
            formControlName="item"
            [ordenando]="ordenar" 
            (delete)="EliminarElemento(personalForm, i)"
            (change)="ChangeData()"
            >
            </app-item-perfil>
          </div>
        </mat-expansion-panel>
        
        <mat-expansion-panel  #ppro  
          cdkDropList
          [cdkDropListData]="profesionalForm"
          (cdkDropListEntered)="AbrirPanel(ppro)"
          (cdkDropListDropped)="MoverItem($event)"
          (cdkDropListExited)="CerrarPanel(ppro)"
          formArrayName="3"
        >
          <mat-expansion-panel-header>
            <mat-panel-title>
              Profesional
            </mat-panel-title>
          </mat-expansion-panel-header>
          <div 
          class="acordion width-100"
          *ngFor="let itemProfesional of profesionalForm.controls; let i = index"
          [formGroupName]="i"
          cdkDrag 
          [cdkDragDisabled]="ordenar"
          [ngClass]="{'ordenar': !ordenar}"
          (cdkDragStarted)="Drag()"
          (cdkDragEnded)="Drop()"
          >
            <app-item-perfil 
            [form]="itemProfesional"
            formControlName="item"
            [ordenando]="ordenar" 
            (delete)="EliminarElemento(profesionalForm, i)"
            (change)="ChangeData()"
            >
            </app-item-perfil>
          </div>
        </mat-expansion-panel>
      </mat-accordion>
    </ion-list>
    </form>
    
    
    <ion-fab vertical="bottom" horizontal="end" slot="fixed"  *ngIf="!isDrag" >
        <ion-fab-button *ngIf="FormValid()" size="small" color="success" (click)="onSubmit()">
          <ion-icon name="save"></ion-icon>
        </ion-fab-button>
        <ion-fab-button size="small" (click)="SeleccionSeccion()">
          <ion-icon name="add"></ion-icon>
        </ion-fab-button>
      
    </ion-fab>

  </ion-content>
</div>